<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HFHS HS Patient Demographic Survey</title>
    <!-- Bootstrap CSS -->
    <link href="./resources/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery UI for text suggestions -->
    <link rel="stylesheet" href="./resources/css/jquery-ui.css">
    <link href="./resources/css/custom.css" rel="stylesheet">
    <link href="./resources/img/hfhs.ico" rel="shortcut icon">
</head>

<body>

    <div class="container mt-5">
        <h2>HS Patient Demographic Survey</h2>
        <form id="dataForm">
            <!-- Text Box -->
            <div class="row">
                <div class="form-group col-4">
                    <label for="disease_state">Enrollment Number</label>
                    <div class="row">
                        <!-- Disease select (10% width) -->
                        <div class="col-5">
                            <select class="form-control" id="disease_state" name="disease_state" required>
                                <option value="HS">HS</option>
                                <option value="HC">HC</option>
                            </select>
                        </div>
                        <p>-</p>
                        <!-- Other input (20% width) -->
                        <div class="col-5">
                            <input type="text" class="form-control" name="enrollment_number" id="enrollment_number"
                                required>
                        </div>
                    </div>
                </div>

                <div class="form-group col-8 ml-auto">
                    <div class="row justify-content-end">
                        <div class="col-5">
                            <label for="collection_site" class="d-block" style="text-align: right">Collection
                                Site</label>
                            <select class="form-control" id="collection_site" name="collection_site" required>
                                <option value="" disabled selected>Enter Site</option>
                                <option value="hamzavi_clinic">Hamzavi Clinic</option>
                                <option value="new_center_one">New Center One</option>
                                <option value="wayne">WSU</option>
                            </select>
                        </div>

                        <div class="col-5">
                            <div class="form-group" style="text-align: right;">
                                <label class="d-block">Sample Type</label>
                                <div class="d-flex justify-content-between sample-check">
                                    <div class="form-check">
                                        <label class="form-check-label sample-check">
                                            <input type="checkbox" id="blood_checked" name="sample_type" value="Blood"
                                                required> Blood
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <label class="form-check-label sample-check">
                                            <input type="checkbox" id="saliva_checked" name="sample_type" value="Saliva"
                                                required> Saliva
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <label class="form-check-label sample-check">
                                            <input type="checkbox" id="tissue_checked" name="sample_type" value="Tissue"
                                                required> Tissue
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="form-group row justify-content-end ml-auto" id="blood_tubes" style="display:none">
                <div class="col-2 d-flex align-items-center justify-content-end" id="green_tube_container">
                    <label for="green_tube" class="mr-2" style="text-align: right">G</label>
                    <select type="number" class="form-control" name="green_tube" id="green_tube" value="0" required>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>
                </div>

                <div class="col-2 d-flex align-items-center justify-content-end" id="red_tube_container">
                    <label for="red_tube" class="mr-2" style="text-align: right">R</label>
                    <select type="number" class="form-control" name="red_tube" id="red_tube" value="0" required>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>
                </div>
                <div class="col-2 d-flex align-items-center justify-content-end" id="purple_tube_container">
                    <label for="purple_tube" class="mr-2" style="text-align: right">P</label>
                    <select type="number" class="form-control" name="purple_tube" id="purple_tube" value="0" required>
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="first_name">Collector Name</label>
                <div class="row">
                    <div class="col-4">
                        <input type="text" class="form-control" name="col_first_name" id="col_first_name"
                            placeholder="First Name" required>
                    </div>
                    <div class="col-4">
                        <input type="text" class="form-control" name="col_last_name" id="col_last_name"
                            placeholder="Last Name" required>
                    </div>
                </div>
            </div>


            <br>
            <label class="h4">Patient Basic Demographic Data</label>
            <hr style="border: none; border-top: 1px solid black; margin: 0 0 10px 0">
            <!-- Text Box -->
            <div class="form-group">
                <label for="first_name">Patient Name</label>
                <div class="row">
                    <div class="col-4">
                        <input type="text" class="form-control" name="first_name" id="first_name"
                            placeholder="First Name" required>
                    </div>
                    <div class="col-4">
                        <input type="text" class="form-control" name="last_name" id="last_name" placeholder="Last Name"
                            required>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="mrn">MRN</label>
                <input type="text" class="form-control" name="mrn" id="mrn" required>
            </div>

            <!-- Date Box -->
            <div class="form-group">
                <label for="dob">Patient Date of Birth</label>
                <input type="date" class="form-control" id="dob" name="dob" required>
            </div>

            <div class="form-group">
                <label for="race">Race</label>
                <select class="form-control" id="race" name="race" required>
                    <option value="" disabled selected>Enter Race</option>
                    <option value="african_american">African American</option>
                    <option value="caucasian">Caucasian</option>
                    <option value="asian">Asian</option>
                    <option value="hispanic">Hispanic/Latino</option>
                    <option value="native_american">Native American</option>
                    <option value="other">Other</option>
                </select>
                <input type="text" class="form-control" id="race-other" name="race-other" style="display: none;"
                    placeholder="Enter Race">
            </div>
            <div class="form-group">
                <label for="sex">Sex</label>
                <select class="form-control" id="sex" name="sex" required>
                    <option value="" disabled selected>Enter Sex</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="bmi">BMI</label>
                <input type="number" class="form-control" id="bmi" name="bmi" step="0.01" min="0"
                    placeholder="Enter BMI">
            </div>

            <div class="form-group">
                <label for="hurley">Hurley Stage (Highest)</label>
                <select class="form-control" id="hurley" name="hurley" required>
                    <option value="" disabled selected>Enter Hurley Stage</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                </select>
            </div>
            </br>
            <label class="h4">Lesion Location Counts</label>
            <hr style="border: none; border-top: 1px solid black; margin: 0 0 10px 0">
            <div class="form-group">
                <div class="row">
                    <div class="col-5">
                        <table class="table" id="lesion_table">
                            <thead>
                                <tr>
                                    <th>Lesion Location</th>
                                    <th>Number of Lesions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Axillae</td>
                                    <td><input type="number" id="axillae" name="axillae" class="form-control number-box"
                                            placeholder="0" min="0" readonly>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Mammary</td>
                                    <td><input type="number" id="mammary" name="mammary" class="form-control number-box"
                                            placeholder="0" min="0" readonly></td>
                                </tr>
                                <tr>
                                    <td>Other Upper</td>
                                    <td><input type="number" id="other_upper" name="other_upper"
                                            class="form-control number-box" placeholder="0" min="0" readonly></td>
                                </tr>
                                <tr>
                                    <td>Buttocks</td>
                                    <td><input type="number" id="buttocks" name="buttocks"
                                            class="form-control number-box" placeholder="0" min="0" readonly></td>
                                </tr>
                                <tr>
                                    <td>Genital</td>
                                    <td><input type="number" id="genital" name="genital" class="form-control number-box"
                                            placeholder="0" min="0" readonly></td>
                                </tr>
                                <tr>
                                    <td>Other Lower</td>
                                    <td><input type="number" id="other_lower" name="other_lower"
                                            class="form-control number-box" placeholder="0" min="0" readonly></td>
                                </tr>

                                <tr>
                                    <td><u>HS-IGA Score</u></td>
                                    <td><input type="number" id="hs-iga" name="hs-iga" class="form-control number-box"
                                            placeholder="0" min="0" readonly></td>
                                </tr>
                                <tr>
                                    <td><u>IHS4 Score</u></td>
                                    <td><input type="number" id="ihs4" name="ihs4" class="form-control number-box"
                                            placeholder="0" min="0" readonly></td>
                                </tr>
                                <tr>
                                    <td><u>HS-PGA Score</u></td>
                                    <td><input type="number" id="pga" name="pga" class="form-control number-box"
                                            placeholder="0" min="0" readonly></td>
                                </tr>

                            </tbody>
                        </table>
                        <button id="clear_body_map" type="button" class="btn btn-danger">Clear Lesion Counts</button>
                        <button id="clear_last_lesion" type="button" class="btn btn-secondary">Undo</button>
                    </div>
                    <div class="col-5">
                        <div style="position: relative;">
                            <canvas id="body_map" style="display: block; border: none;"></canvas>
                            <canvas id="lesion_map"
                                style="display: block; position: absolute; top: 0; left: 0;"></canvas>
                        </div>
                        <div style="display: none; justify-content: center; margin-top: 10px;" id="drawing_buttons">
                            <button class="btn btn-outline-secondary" style="flex: 3.5; margin-right: 5px;"
                                id="inf_nodule_button">Inflamm. Nodule</button>
                            <button class="btn btn-outline-secondary" style="flex: 3.5; margin-right: 5px;"
                                id="non-inf_nodule_button">Non-Inflamm. Nodule</button>
                            <button class="btn btn-outline-secondary" style="flex: 1; margin-right: 5px;"
                                id="abcess_button">Abcess</button>
                            <button class="btn btn-outline-secondary" style="flex: 2.5; margin-right: 5px;"
                                id="draining_tunnel_button">Draining
                                Tunnel</button>
                            <button class="btn btn-outline-secondary" style="flex: 3.5;"
                                id="non-draining_tunnel_button">Non-Draining Tunnel</button>
                        </div>
                    </div>
                </div>

            </div>
            <br>
            <label class="h4">Patient Risks</label>
            <hr style="border: none; border-top: 1px solid black; margin: 0 0 10px 0">
            <div class="form-group">
                <label for="smoking_history_yes" class="form-label">Does the patient have a smoking history?</label>
                <div>
                    <input type="radio" id="smoking_history_yes" name="smoking_history" value="yes"
                        class="form-radio-input">
                    <label class="form-check-label" for="smoking_history_yes">Yes</label>
                </div>
                <div>
                    <input type="radio" id="smoking_history_no" name="smoking_history" value="no"
                        class="form-radio-input">
                    <label class="form-check-label" for="smoking_history_no">No</label>
                </div>
                <div>
                    <input type="radio" id="smoking_history_unknown" name="smoking_history" value="unknown"
                        class="form-radio-input">
                    <label class="form-check-label" for="smoking_history_unknown">Unknown</label>
                </div>
                <div class="mb-3" id="packHistoryContainer" style="display: none;">
                    <label for="packHistory" class="form-label">Pack History:</label>
                    <input type="number" id="packHistory" name="pack_history" class="form-control"
                        placeholder="Packs per Day" min="0">
                </div>
            </div>
            <div class="form-group">
                <label for="rec_drugs_history_yes" class="form-label">Does the patient use recreational
                    drugs?</label>
                <div>
                    <input type="radio" id="rec_drugs_history_yes" name="rec_drugs_history" value="yes"
                        class="form-radio-input">
                    <label class="form-check-label" for="rec_drugs_history_yes">Yes</label>
                </div>
                <div>
                    <input type="radio" id="rec_drugs_history_no" name="rec_drugs_history" value="no"
                        class="form-radio-input">
                    <label class="form-check-label" for="rec_drugs_history_no">No</label>
                </div>
                <div>
                    <input type="radio" id="rec_drugs_history_unkown" name="rec_drugs_history" value="unknown"
                        class="form-radio-input">
                    <label class="form-check-label" for="rec_drugs_history_unkown">Unknown</label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="comorbidities">Select Comorbidities (tap to remove)</label>
                <div class="suggestions-container">
                    <input type="text" id="comorbidities" class="form-control"
                        placeholder="Type to search, if not found press enter to add new item..." />
                </div>
                <div id="selected-comorbidities" class="mt-2"></div>
            </div>
            <br>
            <label class="h4">Family History</label>
            <hr style="border: none; border-top: 1px solid black; margin: 0 0 10px 0">
            <div class="form-group" id="family_parent">
                <label class="form-label">Does the patient have a family history of HS?</label>
                <div class="form-check">
                    <input type="radio" id="family_history_yes" class="form-check-input" name="family_history"
                        value="yes">
                    <label class="form-check-label" for="family_history_yes">Yes</label>
                </div>
                <div class="form-check">
                    <input type="radio" id="family_history_no" class="form-check-input" name="family_history"
                        value="no">
                    <label class="form-check-label" for="family_history_no">No</label>
                </div>
                <div class="form-check">
                    <input type="radio" id="family_history_unknown" class="form-check-input" name="family_history"
                        value="unknown">
                    <label class="form-check-label" for="family_history_unknown">Unknown</label>
                </div>
                <br>
                <div id="familyContainer" style="display: none;">
                    <label class="form-label" id="family_title"><u>Family Member 1:</u></label>
                    <div class="form-group">
                        <label>Relation</label>
                        <input type="text" class="form-control" id="familyRelation" placeholder="Relation to Patient">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Have we already collected a sample from this relation?</label>
                        <div class="form-check">
                            <input type="radio" id="family_collect_yes" class="form-check-input" name="family_collect"
                                value="yes">
                            <label class="form-check-label" for="family_collect_yes">Yes</label>
                        </div>
                        <div class="form-check">
                            <input type="radio" id="family_collect_no" class="form-check-input" name="family_collect"
                                value="no">
                            <label class="form-check-label" for="family_collect_no">No</label>
                        </div>
                    </div>
                    <!-- if have -->

                    <div class="form-group" id="relation_id" style="display: none">
                        <label>Relation Enrollment Number </label>
                        <div style="display: flex; align-items: center;">
                            <span>HS - </span> <!-- Text "HS - " -->
                            <div class="col-2">
                                <input type="text" class="form-control" name="relation_enrollment_number"
                                    id="relation_enrollment_number" required>
                            </div>
                        </div>
                    </div>

                    <!-- if haven't collected information -->
                    <div id="new_relation_info" style="display: none">
                        <div class="form-group">
                            <label>Name</label>
                            <div class="row">
                                <div class="col-4">
                                    <input type="text" class="form-control" name="rel_first_name" id="rel_first_name"
                                        placeholder="First Name" required>
                                </div>
                                <div class="col-4">
                                    <input type="text" class="form-control" name="rel_last_name" id="rel_last_name"
                                        placeholder="Last Name" required>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="familyEmail">Email</label>
                            <input type="email" class="form-control" id="familyEmail" placeholder="Email">
                        </div>
                        <div class="form-group">
                            <label for="familyAddress">Address</label>
                            <input type="text" class="form-control" id="familyAddress" placeholder="1234 Main St">
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="familyCity">City</label>
                                <input type="text" class="form-control" id="familyCity">
                            </div>
                            <div class="form-group col-md-4">
                                <label for="familyState">State</label>
                                <input list="states" id="familyState" name="familyState" class=form-control />
                                <datalist>
                                    <option value="AL">
                                    <option value="AK">
                                    <option value="AZ">
                                    <option value="AR">
                                    <option value="CA">
                                    <option value="CO">
                                    <option value="CT">
                                    <option value="DE">
                                    <option value="FL">
                                    <option value="GA">
                                    <option value="HI">
                                    <option value="ID">
                                    <option value="IL">
                                    <option value="IN">
                                    <option value="IA">
                                    <option value="KS">
                                    <option value="KY">
                                    <option value="LA">
                                    <option value="ME">
                                    <option value="MD">
                                    <option value="MA">
                                    <option value="MI">
                                    <option value="MN">
                                    <option value="MS">
                                    <option value="MO">
                                    <option value="MT">
                                    <option value="NE">
                                    <option value="NV">
                                    <option value="NH">
                                    <option value="NJ">
                                    <option value="NM">
                                    <option value="NY">
                                    <option value="NC">
                                    <option value="ND">
                                    <option value="OH">
                                    <option value="OK">
                                    <option value="OR">
                                    <option value="PA">
                                    <option value="RI">
                                    <option value="SC">
                                    <option value="SD">
                                    <option value="TN">
                                    <option value="TX">
                                    <option value="UT">
                                    <option value="VT">
                                    <option value="VA">
                                    <option value="WA">
                                    <option value="WV">
                                    <option value="WI">
                                    <option value="WY">
                                </datalist>
                            </div>
                            <div class="form-group col-md-2">
                                <label for="familyZip">Zip</label>
                                <input type="text" class="form-control" id="familyZip">
                            </div>
                        </div>
                    </div>
                    <div class="form-group mb-3">
                        <label for="familyNotes">Notes</label>
                        <input type="text" class="form-control" id="familyNotes" name="familyNotes">
                    </div>
                    <button type="button" class="addRelative btn btn-primary" style="margin-top: 10px;">Add Another
                        Relative</button>
                    <hr style="border: none; border-top: 1px solid black; margin: 20px 0">
                </div>

            </div>
            <br>
            <label class="h4">Patient Treatments</label>
            <hr style="border: none; border-top: 1px solid black; margin: 0 0 10px 0">
            <div class="form-group">
                <label class="form-label" for="current_hs_meds">Select Current HS Medications (tap to remove)</label>
                <div class="suggestions-container">
                    <input type="text" id="current_hs_meds" class="form-control"
                        placeholder="Type to search, if not found press enter to add new item..." />
                </div>
                <div id="selected-curr-hs-meds" class="mt-2"></div>
            </div>

            <div class="form-group">
                <label class="form-label" for="disc_hs_meds">Select Discontinued HS Medications (tap to remove)</label>
                <div class="suggestions-container">
                    <input type="text" id="disc_hs_meds" class="form-control"
                        placeholder="Type to search, if not found press enter to add new item..." />
                </div>
                <div id="selected-disc-hs-meds" class="mt-2"></div>
            </div>

            <div class="form-group">
                <label class="form-label">Is the patient on a biologic?</label>
                <div class="form-check">
                    <input type="checkbox" id="biologics_history" class="form-check-input">
                    <label class="form-check-label" for="biologics_history">Yes</label>
                </div>
                <div class="mb-3" id="biologicsContainer" style="display: none;">
                    <label class="form-label" for="biologics_list">Name/Type of Biologic (tap to remove)</label>
                    <div>
                        <input type="text" id="biologics_list" class="form-control" placeholder="Type to search..." />
                    </div>
                    <div id="selected-biologics" class="mt-2"></div>
                    <label class="form-label" for="biologics_response">Effect of biologic treatment on patient HS
                        condition</label>
                    <select class="form-control" id="biologics_response" name="biologics_response">
                        <option value="" disabled selected>Select Option</option>
                        <option value="improve">Improve</option>
                        <option value="no_change">No Change</option>
                        <option value="worsen">Worsening</option>
                    </select>
                    <input type="text" class="form-control" id="suggestionBox" name="suggestionBox"
                        placeholder="Describe lesion changes if any...">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Any surgeries/procedures for HS lesions?</label>
                <div class="form-check">
                    <input type="checkbox" id="procedures_history_check" class="form-check-input">
                    <label class="form-check-label" class="form-control" for="procedures_history_check">Yes</label>
                </div>
                <div class="mb-3" id="proceduresContainer" style="display: none;">
                    <input type="text" id="procedures_history" class="form-control" placeholder="Explain..">
                </div>
            </div>





            <!-- Text Box with Suggestions -->
            <div class="form-group">
                <label for="other_notes">Other Notes (Optional)</label>
                <input type="text" class="form-control" id="other_notes" name="other_notes"
                    placeholder="Type something...">
            </div>

            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>

    <!-- jQuery, Bootstrap JS, and jQuery UI -->
    <script src="./resources/js/jquery-3.5.1.min.js"></script>
    <script src="./resources/js/jquery-ui.min.js"></script>
    <script src="./resources/js/bootstrap.min.js"></script>
    <script src="./resources/js/crypto-js.min.js"></script>

    <!-- load medicines list -->
    <script src="./resources/js/constants.js"></script>

    <!-- hidden questions -->
    <script>

        // DEBUG
        const family_container_base = document.getElementById('familyContainer').innerHTML;
        const debug = true;
        const bloodChecked = document.getElementById('blood_checked');
        const salivaChecked = document.getElementById('saliva_checked');
        const tissueChecked = document.getElementById('tissue_checked');
        const smokingHistoryCheckbox = document.getElementById('smoking_history_yes');
        const packHistoryContainer = document.getElementById('packHistoryContainer');
        const biologicCheckbox = document.getElementById('biologics_history');
        const biologicsContainer = document.getElementById('biologicsContainer');
        const proceduresCheckbox = document.getElementById('procedures_history_check');
        const proceduresContainer = document.getElementById('proceduresContainer');
        const familyContainer = document.getElementById('familyContainer');
        const familyCheckbox = document.getElementById('family_history');
        const raceBox = document.getElementById('race');
        const raceContainer = document.getElementById('race-other');
        const sexBox = document.getElementById('sex');
        const canvas = document.getElementById('body_map');
        const ctx = canvas.getContext("2d");
        const relation_id = document.getElementById('relation_id');
        const new_relation_info = document.getElementById('new_relation_info');
        const family_parent = document.getElementById('family_parent');

        const lesion_canvas = document.getElementById('lesion_map');
        const ltx = lesion_canvas.getContext("2d");
        ltx.font = '200px Arial'
        const lesionTable = document.getElementById('lesion_table');
        const smoking_radios = document.querySelectorAll('input[name="smoking_history"]');
        const drug_radios = document.querySelectorAll('input[name="rec_drugs_history"]');
        const family_radios = document.querySelectorAll('input[name="family_history"]');
        const family_collect_radios = document.querySelectorAll('input[name="family_collect"]');
        const bloodContainer = document.getElementById("blood_tubes");
        const lesion_undo = document.getElementById("clear_last_lesion");
        const drawing_buttons = document.getElementById("drawing_buttons");
        let point_style;
        let bodyImage;
        let number_of_relations = 0;

        // [non inf nodules, inf nodules, abcess, draining tunnel, non-draining tunnel]
        let lesiontypesdict = {
            "axillae": { "Non-Inflammatory Nodule": 0, "Inflammatory Nodule": 0, "Abcess": 0, "Draining Tunnel": 0, "Non-Draining Tunnel": 0 },
            "mammary": { "Non-Inflammatory Nodule": 0, "Inflammatory Nodule": 0, "Abcess": 0, "Draining Tunnel": 0, "Non-Draining Tunnel": 0 },
            "genital": { "Non-Inflammatory Nodule": 0, "Inflammatory Nodule": 0, "Abcess": 0, "Draining Tunnel": 0, "Non-Draining Tunnel": 0 },
            "buttocks": { "Non-Inflammatory Nodule": 0, "Inflammatory Nodule": 0, "Abcess": 0, "Draining Tunnel": 0, "Non-Draining Tunnel": 0 },
            "other_upper": { "Non-Inflammatory Nodule": 0, "Inflammatory Nodule": 0, "Abcess": 0, "Draining Tunnel": 0, "Non-Draining Tunnel": 0 },
            "other_lower": { "Non-Inflammatory Nodule": 0, "Inflammatory Nodule": 0, "Abcess": 0, "Draining Tunnel": 0, "Non-Draining Tunnel": 0 }
        };
        let lesioncountsdict = { "axillae": 0, "mammary": 0, "genital": 0, "buttocks": 0, "other_upper": 0, "other_lower": 0 };
        let gender;
        let response;
        let upper_total;
        let lower_total;
        let polygon_dict = {};
        let allowdraw = false;

        // get rid of required for everything if debug
        if (debug) {
            const formFields = document.querySelectorAll('#dataForm [required]');

            // arrow func implicit return, function(field){field.removeAttribute();}
            // array.forEach(callback_function_applied(currentValue, index, array), thisArg);
            /*if (debug) {
                const formFields = document.querySelectorAll('#dataForm [required]');
                const context = { prefix: 'Field: ' };

                formFields.forEach(function(field) {
                    console.log(this.prefix + field.name);
                    field.removeAttribute('required');
                }, context);

                submit_form();
                return;
            }*/
            formFields.forEach(field => field.removeAttribute('required'));
        }

        function appendFamilyContainer() {
            let new_family_container = document.createElement('div');
            number_of_relations++;
            new_family_container.id = 'familyContainer' + number_of_relations;
            new_family_container.innerHTML = family_container_base;

            // change title of new section
            new_family_container.querySelector('#family_title').innerHTML = '<u>Family Member ' + number_of_relations + ':</u>';

            // update ids and names
            new_family_container.querySelector('#familyRelation').id = 'familyRelation' + '_' + number_of_relations;
            new_family_container.querySelector('#family_collect_yes').id = 'family_collect_yes' + '_' + number_of_relations;
            new_family_container.querySelector('#family_collect_yes' + '_' + number_of_relations).name = 'family_collect' + '_' + number_of_relations;
            new_family_container.querySelector('#family_collect_no').id = 'family_collect_no' + '_' + number_of_relations;
            new_family_container.querySelector('#family_collect_no' + '_' + number_of_relations).name = 'family_collect' + '_' + number_of_relations;


            new_family_container.querySelector('#relation_id').id = 'relation_id' + '_' + number_of_relations;
            new_family_container.querySelector('#relation_enrollment_number').id = 'relation_enrollment_number' + '_' + number_of_relations;
            new_family_container.querySelector('#new_relation_info').id = 'new_relation_info' + '_' + number_of_relations;
            new_family_container.querySelector('#rel_first_name').id = 'rel_first_name' + '_' + number_of_relations;
            new_family_container.querySelector('#rel_last_name').id = 'rel_last_name' + '_' + number_of_relations;
            new_family_container.querySelector('#familyEmail').id = 'familyEmail' + '_' + number_of_relations;
            new_family_container.querySelector('#familyAddress').id = 'familyAddress' + '_' + number_of_relations;
            new_family_container.querySelector('#familyCity').id = 'familyCity' + '_' + number_of_relations;
            new_family_container.querySelector('#familyState').id = 'familyState' + '_' + number_of_relations;
            new_family_container.querySelector('#familyZip').id = 'familyZip' + '_' + number_of_relations;
            new_family_container.querySelector('#familyNotes').id = 'familyNotes' + '_' + number_of_relations;

            // Append the cloned container to the form
            family_parent.appendChild(new_family_container);
        }

        // Get all buttons within the container
        const buttons = drawing_buttons.querySelectorAll('button');

        function resetButtons() {
            buttons.forEach(btn => {
                btn.classList.remove('btn-secondary');
                btn.classList.add('btn-outline-secondary');
            });
        }

        // Add click event listener to each button
        buttons.forEach(button => {
            button.addEventListener('click', function (event) {
                if (!allowdraw) {
                    enableDrawing(lesion_canvas);
                }
                event.preventDefault();
                resetButtons();

                // Change clicked button to btn-outline-secondary
                this.classList.remove('btn-outline-secondary');
                this.classList.add('btn-secondary');
                // Get the text content of the clicked button
                const buttonId = event.target.id;
                console.log(buttonId);

                // Perform action based on which button was clicked
                switch (buttonId) {
                    case 'inf_nodule_button':
                        point_style = "Inflammatory Nodule";
                        break;
                    case 'non-inf_nodule_button':
                        point_style = "Non-Inflammatory Nodule";
                        break;
                    case 'abcess_button':
                        console.log('Abcess button clicked');
                        point_style = "Abcess";
                        break;
                    case 'draining_tunnel_button':
                        console.log('Draining Tunnel button clicked');
                        point_style = "Draining Tunnel";
                        break;
                    case 'non-draining_tunnel_button':
                        console.log('Non-Draining Tunnel button clicked');
                        point_style = "Non-Draining Tunnel";
                        break;
                    default:
                        // should not happen
                        console.log('Unknown button clicked');
                }
            });
        });

        smoking_radios.forEach(radio => {
            radio.addEventListener('change', function () {
                if (this.value === 'yes') {
                    packHistoryContainer.style.display = 'block'; // Show pack history input if "Yes" is selected
                } else {
                    packHistoryContainer.style.display = 'none'; // Hide it if "No" or "Unknown" is selected
                    $("#packHistory").val("");
                }
            });
        });

        family_radios.forEach(radio => {
            radio.addEventListener('change', function () {
                if (this.value === 'yes') {
                    familyContainer.style.display = 'block'; // Show pack history input if "Yes" is selected
                    number_of_relations++;
                } else {
                    familyContainer.style.display = 'none'; // Hide it if "No" or "Unknown" is selected
                    number_of_relations--;
                }
            });
        });


        // add event delegator for the family buttons
        function canBeInt(str) {
            // Trim whitespace from the string and attempt to parse it as an integer
            const parsed = parseInt(str, 10);
            // Check if the parsed value is a number and equals the original string when converted to string
            return !isNaN(parsed) && parsed.toString() === str;
        }

        family_parent.addEventListener('click', function (event) {
            // parent family_collect listener
            if (event.target.name == 'family_collect') {
                if (event.target.value === 'yes') {
                    document.getElementById('relation_id').style.display = 'block';
                    document.getElementById('new_relation_info').style.display = 'none';
                } else {
                    document.getElementById('relation_id').style.display = 'none';
                    document.getElementById('new_relation_info').style.display = 'block';
                }
                return;
            }

            // Add event listener for the initial "Add Another Relative" button
            if (event.target.classList.contains('addRelative')) {
                event.target.remove();
                appendFamilyContainer();
                return;
            };

            // get event target relation number
            let target_id = event.target.id;

            // if target id is undefined
            if (!target_id) {
                console.log("target id is undefined");
                return;
            }
            let relation_number = target_id.split('_')[target_id.split('_').length - 1].trim();
            if (!canBeInt(relation_number)) {
                console.log(target_id);
                console.log("invalid relation number");
                return;
            }

            // children family_collect listener
            if (event.target.name.startsWith('family_collect')) {
                if (event.target.value === 'yes') {
                    document.getElementById('relation_id' + '_' + relation_number).style.display = 'block';
                    document.getElementById('new_relation_info' + '_' + relation_number).style.display = 'none';
                } else {
                    document.getElementById('relation_id' + '_' + relation_number).style.display = 'none';
                    document.getElementById('new_relation_info' + '_' + relation_number).style.display = 'block';
                }
            }
        });


        raceBox.addEventListener('change', function () {
            if (this.value == "other") {
                raceContainer.style.display = 'block';
                raceContainer.required = true;
            }
            else {
                raceContainer.style.display = 'none';
                raceContainer.required = false;
            }
        });

        bloodChecked.addEventListener('change', function () {
            if (this.checked) {
                bloodContainer.style.display = 'flex';
            }
            else {
                bloodContainer.style.display = 'none';
            }
        });


        biologicCheckbox.addEventListener('change', function () {
            if (this.checked) {
                biologicsContainer.style.display = 'block'; // Show pack history input if checkbox is checked
            } else {
                biologicsContainer.style.display = 'none'; // Hide it if unchecked
            }
        });

        proceduresCheckbox.addEventListener('change', function () {
            if (this.checked) {
                proceduresContainer.style.display = 'block'; // Show pack history input if checkbox is checked
            } else {
                proceduresContainer.style.display = 'none'; // Hide it if unchecked
            }
        });

        function drawImage(gender_) {
            // might need to adjust for tablet
            bodyImage = new Image(600, 554);
            canvas.height = lesion_canvas.height = bodyImage.height;
            canvas.width = lesion_canvas.width = bodyImage.width;

            // change buttons to match
            drawing_buttons.style.width = canvas.offsetWidth + 'px';

            bodyImage.onload = drawImageActualSize;
            if (gender_ == "male") {
                bodyImage.src = "./resources/img/male-iga.png";
            }
            if (gender_ == "female") {
                bodyImage.src = "./resources/img/female-iga.png";
            }
        }

        function drawImageActualSize() {
            ctx.drawImage(this, 0, 0, this.width, this.height);
            drawPolygons();
            canvas.style.border = '2px solid black';
        }

        sexBox.addEventListener('change', function () {
            console.log("changed sex");
            var tableHeight = lesionTable.offsetHeight;
            drawing_buttons.style.display = "flex";
            if (this.value.trim().toLowerCase() == "male" || this.value.trim().toLowerCase() == "other") {
                console.log("male");
                clearCounts();
                gender = "male";
                drawImage(gender);
            }
            else if (this.value.trim().toLowerCase() == "female") {
                console.log("female");
                gender = "female";
                clearCounts();
                drawImage(gender);
            }
            else {
                return;
            }
            disableDrawing(lesion_canvas);

        });

        function drawPolygon(points, key) {
            ctx.beginPath();
            ctx.moveTo(points[0][0], points[0][1]);
            for (let i = 1; i < points.length; i++) {
                ctx.lineTo(points[i][0], points[i][1]);
            }
            ctx.closePath();

            if (key.startsWith("Axillae")) {
                ctx.fillStyle = "rgba(127,128,0,0.5)"
            }
            if (key.startsWith("Genital")) {
                ctx.fillStyle = "rgba(255,0,0,0.5)"
            }
            if (key.startsWith("Buttocks")) {
                ctx.fillStyle = "rgba(28,144,255,0.5)"
            }
            if (key.startsWith("Mammary")) {
                ctx.fillStyle = "rgba(50,255,0,0.5)"
            }
            ctx.fill();
            ctx.stroke();

        }

        // Function to draw all polygons on the canvas
        async function drawPolygons() {
            if (gender == "male") {
                for (const key in male_polygons) {
                    drawPolygon(male_polygons[key], key);
                }
            }
            if (gender == "female") {
                for (const key in female_polygons) {
                    drawPolygon(female_polygons[key], key);
                }
            }
        }

        // Point-in-polygon function
        function isPointInPolygon(point, polygon) {
            let x = point[0], y = point[1];
            let inside = false;

            for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
                const xi = polygon[i][0], yi = polygon[i][1];
                const xj = polygon[j][0], yj = polygon[j][1];

                const intersect = ((yi > y) !== (yj > y)) &&
                    (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
                if (intersect) inside = !inside;
            }

            return inside;
        }

        // Update counters on the page
        function updateCounters() {
            document.getElementById("axillae").value = lesioncountsdict["axillae"];
            document.getElementById("mammary").value = lesioncountsdict["mammary"];
            document.getElementById("buttocks").value = lesioncountsdict["buttocks"];
            document.getElementById("genital").value = lesioncountsdict["genital"];
            document.getElementById("other_lower").value = lesioncountsdict["other_lower"];
            document.getElementById("other_upper").value = lesioncountsdict["other_upper"];
            upper_total = lesioncountsdict["other_upper"] + lesioncountsdict["mammary"] + lesioncountsdict["axillae"];
            lower_total = lesioncountsdict["other_lower"] + lesioncountsdict["genital"] + lesioncountsdict["buttocks"];
            document.getElementById("hs-iga").value = hs_iga_scr(Math.max(upper_total, lower_total));
            document.getElementById("ihs4").value = ihs4_scr(lesiontypesdict);
            document.getElementById("pga").value = pga_scr(lesiontypesdict);
        }

        const lesion_body_parts = [];
        // Check which body part is clicked based on coordinates
        function checkBodyPart(x, y) {
            let output_key;
            let lower_region;
            const point = [x, y];
            var validpoint = false;
            if (gender == "male") {
                lower_region = male_lower;
                for (const key in male_polygons) {
                    if (isPointInPolygon(point, male_polygons[key])) {
                        var key_str = key.replace(/[0-9]/g, '').toLowerCase();
                        output_key = key_str;
                        validpoint = true;
                        break;
                    }
                }
            }
            if (gender == "female") {
                lower_region = female_lower;
                for (const key in female_polygons) {
                    if (isPointInPolygon(point, female_polygons[key])) {
                        var key_str = key.replace(/[0-9]/g, '').toLowerCase();
                        output_key = key_str;
                        validpoint = true;
                        break;
                    }
                }
            }
            if (!validpoint) {
                // check if point is in upper or lower body
                if (isPointInPolygon(point, lower_region[0]) || isPointInPolygon(point, lower_region[1])) {
                    output_key = "other_lower";
                }
                else {
                    output_key = "other_upper";
                }
            }
            lesion_body_parts.push([output_key, point_style]);
            lesioncountsdict[output_key] += 1;
            lesiontypesdict[output_key][point_style] += 1;
            updateCounters();
        }

        function clearCounts() {
            ltx.clearRect(0, 0, lesion_canvas.width, lesion_canvas.height);
            lesioncountsdict = { "axillae": 0, "mammary": 0, "genital": 0, "buttocks": 0, "other_upper": 0, "other_lower": 0 };
            lesiontypesdict = {
                "axillae": { "Non-Inflammatory Nodule": 0, "Inflammatory Nodule": 0, "Abcess": 0, "Draining Tunnel": 0, "Non-Draining Tunnel": 0 },
                "mammary": { "Non-Inflammatory Nodule": 0, "Inflammatory Nodule": 0, "Abcess": 0, "Draining Tunnel": 0, "Non-Draining Tunnel": 0 },
                "genital": { "Non-Inflammatory Nodule": 0, "Inflammatory Nodule": 0, "Abcess": 0, "Draining Tunnel": 0, "Non-Draining Tunnel": 0 },
                "buttocks": { "Non-Inflammatory Nodule": 0, "Inflammatory Nodule": 0, "Abcess": 0, "Draining Tunnel": 0, "Non-Draining Tunnel": 0 },
                "other_upper": { "Non-Inflammatory Nodule": 0, "Inflammatory Nodule": 0, "Abcess": 0, "Draining Tunnel": 0, "Non-Draining Tunnel": 0 },
                "other_lower": { "Non-Inflammatory Nodule": 0, "Inflammatory Nodule": 0, "Abcess": 0, "Draining Tunnel": 0, "Non-Draining Tunnel": 0 }
            };
            updateCounters();
        }

        function grayOutCanvas() {
            ltx.fillStyle = "rgba(128, 128, 128, 0.5)";  // Gray color with 50% opacity
            ltx.fillRect(0, 0, lesion_canvas.width, lesion_canvas.height);
            ltx.textAlign = "center";  // Center text horizontally
            ltx.textBaseline = "middle";
            ltx.font = "40px Arial";
            ltx.fillStyle = "white";
            ltx.fillText("Pick a Lesion Type", lesion_canvas.width / 2, lesion_canvas.height / 2);
        }

        function disableDrawing() {
            allowdraw = false;
            grayOutCanvas();
        }

        // To re-enable drawing, you would need to reassign the event handlers
        function enableDrawing() {
            allowdraw = true;
            ltx.clearRect(0, 0, lesion_canvas.width, lesion_canvas.height);
        }



        function drawPoint(x, y, ps) {
            ltx.beginPath();
            ltx.fillStyle = "black";
            ltx.strokeStyle = "black";
            if (ps == "Inflammatory Nodule") {
                ltx.arc(x, y, 2.5, 0, Math.PI * 2);
                ltx.fill();
            }
            else if (ps == "Draining Tunnel") {
                ltx.font = "15px Arial";
                ltx.fillText("=", x, y);
            }
            else if (ps == "Non-Draining Tunnel") {
                ltx.font = "12px Arial";
                ltx.fillText("≠", x, y);
            }
            else if (ps == "Non-Inflammatory Nodule") {
                ltx.arc(x, y, 2.5, 0, Math.PI * 2);
                ltx.stroke();
            }
            else if (ps == "Abcess") {
                ltx.font = "15px Arial";
                ltx.fillText("x", x, y);
            }
        }


        // javascript consts are not immutable, you just can't assign them to something else
        const lesion_points = []
        // Draw lesion point
        lesion_canvas.addEventListener("click", function (event) {
            if (allowdraw) {
                rect = lesion_canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                let body_region;

                if (gender == "male") {
                    body_region = male_region;
                }
                else {
                    body_region = female_region;
                }

                // two bodies per img
                if (!isPointInPolygon([x, y], body_region[0]) && !isPointInPolygon([x, y], body_region[1])) {
                    console.log("point not on body");
                    return;
                }

                lesion_points.push([x, y, point_style]);

                if ($("#sex").val()) {
                    // Mark the clicked point on the canvas
                    drawPoint(x, y, point_style);
                }

                // Check which body part was clicked
                checkBodyPart(x, y);
            }
        });

        function redraw_lesion_points() {
            ltx.clearRect(0, 0, lesion_canvas.width, lesion_canvas.height);
            for (const lesion of lesion_points) {
                drawPoint(lesion[0], lesion[1], lesion[2]);
            }
        }

        function undo_lesion_point() {
            if (lesion_points.length > 0) {
                lesion_points.pop();
                redraw_lesion_points();
                last_part = lesion_body_parts.pop();
                lesioncountsdict[last_part[0]] -= 1;
                lesiontypesdict[last_part[0]][last_part[1]] -= 1;
                updateCounters();

            }
        }

        document.getElementById('clear_body_map').addEventListener('click', function () {
            // Clear the body map or perform other actions
            console.log('Clear Body Map button clicked');
            // Example: Clear the canvas
            clearCounts();
        });

        lesion_undo.addEventListener('click', undo_lesion_point);

    </script>

    <script>
        const form = document.getElementById('dataForm');

        // don't auto submit with enter keypress
        document.addEventListener('keypress', function (event) {
            if (event.key === 'Enter') {
                console.log("enter");
                event.preventDefault(); // Prevent form submission
            }
        });

        document.addEventListener('keydown', function (event) {
            if (event.ctrlKey && event.key === 'z') {
                console.log("undo");
                event.preventDefault(); // Prevent default undo action
                undo_lesion_point(); // Call the undo function
            }
        });

        function get_age(dob, date) {
            const dob_y = dob.getFullYear();
            const dob_m = dob.getMonth();
            const dob_d = dob.getDate();

            const d_y = date.getFullYear();
            const d_m = date.getMonth();
            const d_d = date.getDate();

            let age = d_y - dob_y
            if (d_m > dob_m || (d_m == dob_m && d_d >= dob_d)) {
                age += 1;
            }

            return age;
        }

        function submit_form() {
            let race_val = $("#race").val();
            if (race_val == "other") {
                race_val = $("#race-other").val();
            }

            let smokingValue;
            for (const radio of smoking_radios) {
                if (radio.checked) {
                    smokingValue = radio.value;
                    break;
                }
            }

            let recdrugsValue;

            for (const radio of drug_radios) {
                if (radio.checked) {
                    recdrugsValue = radio.value;
                    break;
                }
            }

            let family_history_list;
            if ($("#family_history").is(":checked")) {
                family_history_list = {
                    relation: $("familyRelation").val(),
                    email: $("familyEmail").val(),
                    address: $("familyAddress").val(),
                    city: $("familyCity").val(),
                    state: $("familyState").val(),
                    zip: $("familyZip").val()
                };
            }
            else {
                family_history_list = {};
            }

            const sample_type = [];

            // Check the state of each checkbox and get its value if checked
            // Add the value to the array if the checkbox is checked
            if (bloodChecked.checked) {
                sample_type.push(bloodChecked.value);
            }
            if (salivaChecked.checked) {
                sample_type.push(salivaChecked.value);
            }
            if (tissueChecked.checked) {
                sample_type.push(tissueChecked.value);
            }

            let today = new Date();

            var formData = {
                date: today,
                disease_state: $("#disease_state").val(),
                enrollment_number: $("#enrollment_number").val(),
                collection_site: $("#collection_site").val(),
                sample_type: sample_type,
                blood_g: $("#green_tube").val(),
                blood_r: $("#red_tube").val(),
                blood_p: $("#purple_tube").val(),
                collector_name: $("#col_first_name").val() + ' ' + $("#col_last_name").val(),
                first_name: $("#first_name").val(),
                last_name: $("#last_name").val(),
                MRN: $("#mrn").val(),
                dob: $("#dob").val(),
                age: get_age(new Date($("#dob").val()), today),
                race: race_val,
                sex: $("#sex").val(),
                bmi: $("#bmi").val(),
                obesity: $("#bmi").val() > 30,
                hurley: $("#hurley").val(),
                axillae: $("#axillae").val(),
                buttocks: $("#buttocks").val(),
                mammary: $("#mammary").val(),
                genital: $("#genital").val(),
                other_upper: $("#other_upper").val(),
                other_lower: $("#other_lower").val(),
                upper_total: upper_total,
                lower_total: lower_total,
                family_history: $("#family_history").is(":checked"),
                family_contact: family_history_list,
                smoking_history: smokingValue,
                pack_history: $("#packHistory").val(),
                recdrugs_usage: recdrugsValue,
                comorbidities: comorbiditiesList, // Assuming this will hold selected comorbidities
                current_hs_meds: currentMedsList, // Assuming this will hold selected current meds
                disc_hs_meds: discontinuedMedsList, // Assuming this will hold selected discontinued meds
                biologics_history: $("#biologics_history").is(":checked"),
                biologics_list: biologicsList,
                biologics_response: $("#biologics_response").val(),
                procedures_history_check: $("#procedures_history_check").is(":checked"),
                procedures_history: $("#procedures_history").val(),
                other_notes: $("#other_notes").val(),
                lesion_map_points: lesion_points,
                suggestionBox: $("#suggestionBox").val()
            };

            // Convert form data to JSON
            var jsonData = JSON.stringify(formData, null, 4);

            var blob = new Blob([jsonData], { type: 'application/json' });
            var url = URL.createObjectURL(blob);

            // Create a link element to trigger the download
            var a = document.createElement('a');
            a.href = url;
            if (debug) {
                a.download = `debug.json`;
            }
            else {
                a.download = `${mrnValue}.json`;
            } // Set the file name to MRN value
            document.body.appendChild(a); // Append to the body
            a.click(); // Trigger the download
            document.body.removeChild(a); // Remove the link


            /* issue with encryption is that secret key can only be obfuscated since
            all the code exists locally. probably not worth the hassle of having people
            use aes to decrypt vs the security benefit.
            // Display JSON in the output div
            $("#jsonOutput").text(jsonData);
 
            var secretKey = "your-secret-key"; // Replace with your secret key
            var encryptedData = CryptoJS.AES.encrypt(jsonData, secretKey).toString();
            */
        }

        // Handle form submission and convert data to JSON
        $("#dataForm").submit(function (event) {
            event.preventDefault(); // Prevent the default form submission

            if (debug) {
                submit_form();
                return;
            }

            var userInput = prompt("Please enter the MRN to confirm:");

            var mrnValue = $("#mrn").val();
            if (userInput !== null) { // Check if the user didn't cancel the prompt
                if (userInput.trim() === mrnValue) {
                    // If numbers match, you can proceed to submit the form or do whatever is needed
                    alert("Numbers match. Submitting the form...");
                    // Collect form data
                    submit_form();
                }
                else {
                    alert("The number you entered does not match the MRN field.");
                }
            }
            else {
                alert("You did not enter anything.");
            }
        });
    </script>

    <script>
        const discontinuedMedsList = [];
        const currentMedsList = [];
        const biologicsList = [];
        const comorbiditiesList = [];

        // wrap in an anonymous function so it only runs after DOM is loaded
        $(function () {
            // comorbidities autocomplete
            $("#comorbidities").autocomplete({
                source: comorbidities,
                minLength: 1,
                select: function (event, ui) {
                    var selected = ui.item.value;
                    addComorbidity(selected);
                    this.value = ''; // Clear the input field
                    return false;
                }
            });

            $("#comorbidities").on("keypress", function (e) {
                if (e.which === 13) { // Enter key
                    var customTag = this.value.trim();
                    if (customTag && !comorbidities.includes(customTag)) {
                        addComorbidity(customTag);
                        this.value = ''; // Clear the input field
                    }
                    e.preventDefault(); // Prevent form submission
                }
            });

            function addComorbidity(comorbidity) {
                var currentComorbidities = $('#selected-comorbidities').text();
                if (!currentComorbidities.includes(comorbidity)) {
                    $('#selected-comorbidities').append('<span class="badge bg-secondary me-1 comorbidity-item">' + comorbidity + '</span>');
                    comorbiditiesList.push(comorbidity);
                }
            }

            $(document).on('click', '.comorbidity-item', function () {
                var comorbidity = $(this).text().trim(); // Get the text value
                $(this).remove(); // Remove the span
                var index = comorbiditiesList.indexOf(comorbidity);
                if (index > -1) {
                    comorbiditiesList.splice(index, 1); // Remove comorbidity from the list
                }
            });

            // current meds autocomplete
            $("#current_hs_meds").autocomplete({
                source: hsMedications,
                minLength: 1,
                select: function (event, ui) {
                    var selected = ui.item.value;
                    addCurrMed(selected);
                    this.value = ''; // Clear the input field
                    return false;
                }
            });

            $("#current_hs_meds").on("keypress", function (e) {
                if (e.which === 13) { // Enter key
                    var customTag = this.value.trim();
                    if (customTag && !hsMedications.includes(customTag)) {
                        addCurrMed(customTag);
                        this.value = ''; // Clear the input field
                    }
                    e.preventDefault(); // Prevent form submission
                }
            });

            function addCurrMed(med) {
                var CurrMed = $('#selected-curr-hs-meds').text();
                if (!CurrMed.includes(med)) {
                    $('#selected-curr-hs-meds').append('<span class="badge bg-secondary me-1 currmed-item">' + med + '</span>');
                    currentMedsList.push(med);
                }
            }

            $(document).on('click', '.currmed-item', function () {
                var currmed = $(this).text().trim(); // Get the text value
                $(this).remove(); // Remove the span
                var index = currentMedsList.indexOf(currmed);
                if (index > -1) {
                    currentMedsList.splice(index, 1);
                }
            });

            // discontinued meds autocomplete
            $("#disc_hs_meds").autocomplete({
                source: hsMedications,
                minLength: 1,
                select: function (event, ui) {
                    var selected = ui.item.value;
                    addDiscMed(selected);
                    this.value = ''; // Clear the input field
                    return false;
                }
            });

            $("#disc_hs_meds").on("keypress", function (e) {
                if (e.which === 13) { // Enter key
                    var customTag = this.value.trim();
                    if (customTag && !hsMedications.includes(customTag)) {
                        addDiscMed(customTag);
                        this.value = ''; // Clear the input field
                    }
                    e.preventDefault(); // Prevent form submission
                }
            });

            function addDiscMed(med) {
                var CurrMed = $('#selected-disc-hs-meds').text();
                if (!CurrMed.includes(med)) {
                    $('#selected-disc-hs-meds').append('<span class="badge bg-secondary me-1 discmed-item">' + med + '</span>');
                    discontinuedMedsList.push(med);
                }
            }

            $(document).on('click', '.discmed-item', function () {
                var discmed = $(this).text().trim(); // Get the text value
                $(this).remove(); // Remove the span
                var index = discontinuedMedsList.indexOf(discmed);
                if (index > -1) {
                    discontinuedMedsList.splice(index, 1);
                }
            });

            // biologics list autocomplete
            $("#biologics_list").autocomplete({
                source: hsBiologics,
                minLength: 1,
                select: function (event, ui) {
                    var selected = ui.item.value;
                    addBiologic(selected);
                    this.value = ''; // Clear the input field
                    return false;
                }
            });

            $("#biologics_list").on("keypress", function (e) {
                if (e.which === 13) { // Enter key
                    var customTag = this.value.trim();
                    if (customTag && !hsMedications.includes(customTag)) {
                        addBiologic(customTag);
                        this.value = ''; // Clear the input field
                    }
                    e.preventDefault(); // Prevent form submission
                }
            });

            function addBiologic(med) {
                var CurrMed = $('#selected-biologics').text();
                if (!CurrMed.includes(med)) {
                    $('#selected-biologics').append('<span class="badge bg-secondary me-1 biologic-item">' + med + '</span>');
                    biologicsList.push(med);
                }
            }

            $(document).on('click', '.biologic-item', function () {
                var bio_item = $(this).text().trim(); // Get the text value
                $(this).remove(); // Remove the span
                var index = biologicsList.indexOf(bio_item);
                if (index > -1) {
                    biologicsList.splice(index, 1);
                }
            });
        });
    </script>


</body>

</html>